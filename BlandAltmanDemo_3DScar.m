%Blant Altman 3D Infarct Segmentation

% Generate data
clear;

noise = 10/100; % percent
npatients = 5; % number of patients
bias = 1.1; % slope bias

% Regions per patient
% territories = {'LAD','LCx','RCA'};
territories = {'First Trial'};
nterritories = length(territories);

% Patient states during measurement
states = {'Scar Vol','Normal Vol'};
nstates = length(states);

% Real flow values
dice_CMF = [0.784222117155228	0.797961622065153	0.689320388349515	0.649109378317918	0.672031944036030	0.649016877610785	0.792769497623025	0.662106802837943	0.681621637740800	0.682802349756151	0.667642731232609	0.621663917438565	0.670851632614092	0.787725757415489	0.710497965579565	0.656482343974934	0.711853151143738	0.514777169663800	0.687285502658012	0.661258387747119	0.787335737131494	0.780233793836344	0.741503214647042	0.745978747984613	0.663418395664829	0.749567897768044	0.659278563319228	0.760127768413857	0.798664086280110	0.639757736663072	0.789088048428576	0.794016519780263	0.767384086740498	0.500200854001458];
dice_FWHM = [0.604442187263218	0.539831185023726	0.761498283838233	0.647860914819256	0.683040775487533	0.667737634871608	0.584478503995834	0.793259470208771	0.461881890164446	0.741057206106995	0.578367406118602	0.555363122041335	0.660084928944827	0.688513355397319	0.527748602673788	0.452834852913377	0.268187661979879	0.435501725597447	0.762994857397384	0.435087820870031	0.653598536188669	0.645020631002360	0.759981198753547	0.749505126209881	0.553618767651205	0.471420153211550	0.419477194424250	0.634706539751050	0.467150825683319	0.487583636445283	0.603494483310710	0.680466732334593	0.685080055495144	0.599478121236451];

ScarVol_CMF_array=[155413.97,59140.168,26598.963,127463.40,124563.48,95069.430,65932.250,125068.01,191079.88,92255.906,88124.906,16641.387,52360.199,153582.42,89248.563,75121.656,59848.984,15447.459,164589.27,118218.32,52070.313,33016.367,143279.25,38318.520,91186.281,69802.164,31320.459,97605.680,99788.930,13162.870,125745.23,135178.73,98698.086,51221.301];
ScarVol_GT_array=[44040.0390625000,28812.2497558594,4085.85937500000,26401.1718750000,19685.8593750000,21116.8750000000,16299.7656250000,18651.4453125000,92113.6328125000,22818.0468750000,13581.4453125000,4218.90625000000,11277.5000000000,40174.5703125000,47110.7812500000,57293.3611410540,23568.5937500000,2363.86718750000,28728.4765625000,59871.0937500000,9988.16406250000,10391.8750000000,47148.8671875000,11771.6015625000,39906.4453125000,25341.3671875000,21896.4990234375,25740.5078125000,30252.4218750000,5904.20487239581,44510.2734375000,39100.5792416198,20106.8359375000,5109.10156250000];
% ScarVol_GT_array=[84574.6484375000,51935.9600830078,7311.99218750000,39535.2343750000,35080.1953125000,33535.4296875000,30768.3593750000,33879.7265625000,175713.281250000,33305.8984375000,25906.5625000000,5020.23437500000,17058.9453125000,71134.3750000000,69508.8671875000,59797.9858178659,41122.6562500000,3590.74218750000,53533.0859375000,109231.484375000,18212.1875000000,17033.5546875000,82848.0859375000,21080.8203125000,73383.4765625000,46536.9531250000,33632.4023437500,36893.0859375000,58033.3203125000,7498.26121411477,79891.0937500000,67833.5372243373,37335.8984375000,8701.87500000000]];
dice_CMF=transpose(dice_CMF);
dice_FWHM=transpose(dice_FWHM);

ScarVol_GT_array=transpose(ScarVol_GT_array);
ScarVol_CMF_array=transpose(ScarVol_CMF_array);

% Baseline data with noise
data1 = cat(2,  ScarVol_CMF_array, ScarVol_GT_array);
% Follow-up data with noise and a bias
data2 = cat(2,  ScarVol_CMF_array, ScarVol_GT_array);

% BA plot paramters
tit = 'Flow Repeatability'; % figure title
gnames = {territories, states}; % names of groups in data {dimension 1 and 2}
label = {'Baseline Flow','Follow-up Flow','mL/min'}; % Names of data sets
corrinfo = {'n','SSE','r2','eq'}; % stats to display of correlation scatter plot
BAinfo = {'RPC(%)'}; % stats to display on Bland-ALtman plot
limits = 'auto'; % how to set the axes limits
if 1
	colors = 'br'; % colors for the data sets
else
        colors = [0 0 1;...
                  1 0 0];
end
symbols = ''; % symbols for the data sets (default)

% Generat figure with symbols
[cr, fig, statsStruct] = BlandAltman(data1, data2,label,tit,gnames,corrinfo,BAinfo,limits,colors,symbols);

% Generate figure with numbers of the data points (patients)
symbols = 'Num';
BlandAltman(data1, data2,label,tit,gnames,corrinfo,BAinfo,limits,colors,symbols)

% Display statistical results that were returned from analyses
disp('Statistical results:');
disp(statsStruct);
